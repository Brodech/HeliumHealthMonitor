@page "/login"

@using HeliumHealthMonitor.Data.Shared.Models
@using HeliumHealthMonitor.Data.MongoDBLayer.DataAccess
@using System.ComponentModel.DataAnnotations
@inject HttpClient Http
@inject IUserSessionInfo _userSessionInfo
@inject IConfiguration _config 
@inject IUserDataAccess _userDataAccess
@inject NavigationManager _navManager

<EditForm Model="@user" OnValidSubmit="OnValid">
<DataAnnotationsValidator/>
<MudGrid>
    <MudGrid>
        <MudItem xs="12">
            <MudGrid>
                <MudItem xs="4">
                    <MudPaper></MudPaper>
                </MudItem>
                <MudItem xs="4">
                    <MudImage Fluid="true" Src="@loginImage" Alt="Login" ObjectPosition="ObjectPosition.Center" Class="m-5" />
                </MudItem>    
                <MudItem xs="4">
                    <MudPaper></MudPaper>
                </MudItem>
            </MudGrid>
        </MudItem>
        <MudItem xs="12">
            <MudGrid>
                <MudItem xs="4">
                    <MudPaper></MudPaper>
                </MudItem>
                <MudItem xs="4">
                    <MudCard>
                        <MudCardContent>
                            <MudTextField Label="Benutzername"
                                            @bind-Value="user.Username" For="@(() => user.Username)"/>
                            <MudTextField Label="Passwort" Class="mt-3"
                                            @bind-Value="user.Password" For="@(() => user.Password)" InputType="InputType.Password"/>
                        </MudCardContent>
                        <MudCardActions>
                            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Login</MudButton>
                        </MudCardActions>
                    </MudCard>
                </MudItem>    
                <MudItem xs="4">
                    <MudPaper></MudPaper>
                </MudItem>
            </MudGrid>
        </MudItem>
    </MudGrid>
    
</MudGrid>
</EditForm>

@code {
    UserLoginFormModel user = new UserLoginFormModel();
    string message = string.Empty;
    bool isDisabled = false;

    bool success;

    string loginImage = " data:image/png;base64,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";

    private async Task OnValid()
    {
        isDisabled = true;
        using(var msg = await Http.PostAsJsonAsync<UserLoginFormModel>($"{_config["ApiBaseAddress"]}/api/userauth/login", user,
            System.Threading.CancellationToken.None))
        {
            if (msg.IsSuccessStatusCode)
            {
                UserLoginResult result = await msg.Content.ReadFromJsonAsync<UserLoginResult>();
                message = result.Message;
                isDisabled = false;
                if (result.Success)
                {

                    _userSessionInfo.Role = result.Role;
                    _userSessionInfo.Id = result.Id;
                    _userSessionInfo.Username = result.Username;
                    _userSessionInfo.JwtBearer = result.JwtBearer;

                    _navManager.NavigateTo("/dashboard");
                }
            }
        }
        StateHasChanged();
    }
}
